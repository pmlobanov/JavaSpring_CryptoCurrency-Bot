# CryptoCurrency Bot

## Описание
Telegram-бот для отслеживания текущей цены для некоторой криптовалюты, изменения цены за некоторый период, подсчета текущей цены портфеля пользователя.

## Техноогичексий стек
- Язык: **Java 23**
- Cборка и управление зависимостями: **Gradle 8.14**
- База данных:  **MongoDB8.0.8 **
- Фреймворк: **Spring 6.2.3**
- Логирование: **SLf4J 2.0.9**
- Брокер сообщений: **Apache Kafka 3.7.0**
- Развертывание и контейнеризация: **Docker-desktop**
- Инструменты:
  - **Spring Data MongoDB 4.2.0**
  - **Spring WebFlux 6.2.3**
  - **Spring Modulith**
  - **Jackson 2.15.2**
  - **Lombook: 1.18.30**
- Тестирование:
  - **Spring test 6.1.3**
  - **Junit 5**  

## Команды бота и дополнтительная функциональность

### Общие команды

| №  | Команда | Описание |
|----|---------|----------|
| 1  | `/start` | Инициализация бота |
| 2  | `/help` | Вывод описания функций и соответствующих им команд |

### Настройка бота
| №  | Команда | Описание |
|----|---------|----------|
| 3  | `/set_fiat <валюта>` | Выбор фиатной валюты по умолчанию |
| 4  | `/set_crypto <криптовалюта>` | Выбор криптовалюты по умолчанию |

### Анализ биржи
| №  | Команда | Описание |
|----|---------|----------|
| 5  | `/compare_сurrency <валюта 1> <валюта 2> <период>` | Сравнение цен двух криптовалют за указанный период |
| 6  | `/show_current_price` | Показать текущую цену криптовалюты по умолчанию |
| 7  | `/show_price_history <период>` | Показать историю цен криптовалюты по умолчанию за период |

### Работа с портфелем
| №  | Команда | Описание |
|----|---------|----------|
| 8  | `/add <количество> <валюта>` | Добавление указанного количества валюты в портфель |
| 9  | `/set_alert_EMA <валюта>` | Установить оповещение по индикатору EMA |
| 9  | `/set_alert_VAL <валюта> <макс_цена> <мин_цена>` | Установить оповещение по значению цены |
| 9  | `/set_alert_PERC <валюта> <макс_рост%> <макс_падение%>` | Установить оповещение по процентному изменению |
| 10 | `/my_alerts` | Показать активные оповещения |
| 11 | `/delete_alert_<тип> <валюта>` | Удалить активное оповещение по типу и валюте |
| 12 | `/delete_all_alerts` | Удаление всех оповещений |
| 13 | `/portfolio` | Просмотр портфеля |
| 14 | `/get_portfolio_price` | Отслеживание цены портфеля за указанный период |
| 15 | `/get_assets_price` | Показать убыток/прибыль по каждой криптовалюте в портфеле |


### Информация об авторах
| №  | Команда | Описание |
|----|---------|----------|
| 16 | `/authors` | Вывод списка авторов |

### Администрирование и проверка состояния бота
| №  | Команда | Описание |
|----|---------|----------|
| 17 | `curl -X GET http://localhost:8080/healthcheck` | Проверка состояния (healthcheck)|
| 18 | `curl -X GET \  http://localhost:8080/admin/users \  -H "Authorization: Bearer YOUR_API_KEY_HERE"` | Авторизация и получение списка пользователей администратором|
| 19 |` curl -X GET \ http://localhost:8080/admin/logs \  -H "Authorization: Bearer YOUR_API_KEY_HERE"` | Авторизация и получение логов приложения администратором|


## Установка и запуск

### Локальная установка

1. Перед установкой убедитесь в соответствии требованиям:
   - Язык: Java 21+
   - БД: MongoDB 8.0.8
   - Gradle 8.14 

2. Для установки клонируйте репозиторий: 


### Docker Hub

## Структура проекта
Приложение организовано в виде набора модулей в соответствии с модульной архитектурой Spring Modulith. Каждый модуль соответствует подпакету в ru.spbstu.mcs.telegramBot и направлен на обслуживание определенной части бота:

- Server (Сервер):
  - ServerApp: Основной файл приложения сервера, который запускает и управляет сервером.
- Config (Конфигурация):
  - AppConfigurations: Конфигурации приложения, которые могут включать настройки базы данных, API ключи и другие параметры.
  - LoggingConfig: Конфигурация логирования, определяющая, как и куда будут записываться логи приложения.
  - SchedulingConfig: Конфигурация задач по расписанию, например, для периодического выполнения определенных операций.
  - VaultConfig: Конфигурация для работы с хранилищем секретов, таких как пароли и ключи API.
- Controller (Контроллер):
  - AdminController: Контроллер для управления административными функциями, такими как управление пользователями и настройками.
- Service (Сервис):
  - AdminAuthMiddleware: Промежуточное ПО для аутентификации администратора.
  - AlertsHandling: Обработка оповещений и уведомлений.
  - BotCommand: Обработка команд бота.
  - KafkaConsumerService: Сервис для потребления сообщений из Kafka.
  - KafkaProducerService: Сервис для отправки сообщений в Kafka.
  - PortfolioManagement: Управление портфелями пользователей.
  - TelegramBotService: Основной сервис для взаимодействия с Telegram API.
- CryptoApi (Крипто API): Этот модуль, вероятно, отвечает за взаимодействие с внешними API для получения данных о криптовалютах.
- DB (База данных):
  - DTO (Data Transfer Objects): Объекты для передачи данных между слоями приложения.
    - UserPortfolioView: Представление портфеля пользователя.
  - encryption: Объекты для шифрования ключей для авторизации администраторов
    - KeyLoader: Загрузчик ключей.
    - PrivateKeyProvider: Поставщик приватных ключей.
    - RsaCryptor: Шифрование и дешифрование с использованием RSA.
    - RsaKeyGenerator: Генератор RSA ключей.
  - Repositories: Репозитории для доступа к данным в базе данных.
    - AdminRepository: Репозиторий для данных об администраторах.
    - NotificationRepository: Репозиторий для уведомлений.
    - PortfolioRepository: Репозиторий для данных портфелей.
    - UserRepository: Репозиторий для данных пользователей.
  - Services: Сервисы для работы с базой данных.
    - AdminService: Сервис для операция с данными администраторов.
    - ApiKeyService: Сервис для управления API ключами.
    - NotificationService: Сервис для управления уведомлениями.
    - PortfolioService: Сервис для управления портфелями.
    - UserService: Сервис для управления пользователями.
- Model (Модель):
  - Admin: Модель данных для администратора.
  - Currency: Модель данных для валют.
  - Notification: Модель данных для уведомлений.
  - Portfolio: Модель данных для портфелей.
  - User: Модель данных для пользователей.
- Security (Безопасность):
  - EncryptionService: Сервис для шифрования данных.
  - KeyGenerator: Генератор ключей.
- Util (Утилиты):
  - ChatIDMasker: утилитный класс для маскирования ID чатов в логах
- Application: Само приложение
- ApplicationConfig: Конфигурация приложения

Диаграмма связи модулей:
<p align="center">
  <img src="https://github.com/pmlobanov/JavaSpring_CryptoCurrencyBot/blob/main/diagram_1.png" alt="Диаграмма модулей приложения" width="700">
</p>



## Команда
- Черепнов Максим 5130201/20101
- Чурова Софья 5130201/20101
- Лобанов Павел 5130201/20101

## Описание коммитов
| Название | Описание                                                        |
|----------|-----------------------------------------------------------------|
| docs	   | Обновление документации                                         |
| feat	   | Добавление нового функционала                                   |
| fix	     | Исправление ошибок                                              |
| refactor | Правки кода без исправления ошибок или добавления новых функций |
| revert   | Откат на предыдущие коммиты                                     |
| style	   | Правки по кодстайлу (табы, отступы, точки, запятые и т.д.)      |

